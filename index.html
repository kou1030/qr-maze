<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å­¦ç¥­è¿·è·¯ã‚²ãƒ¼ãƒ </title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 20px; }
    #game { margin-top: 20px; position: relative; }
    #timer { font-size: 18px; margin-top: 10px; position: fixed; top: 10px; right: 10px; background: rgba(255,255,255,0.8); padding: 5px 10px; border-radius: 5px; z-index: 10; }
    #inventory { margin-top: 20px; font-size: 16px; text-align: left; display: inline-block; }
    button { padding: 10px 20px; margin: 10px; font-size: 16px; }
    video#camera { width: 100%; max-width: 600px; border: 2px solid #333; border-radius: 10px; }
    canvas#arEffect { position: absolute; top:0; left:0; pointer-events: none; }
  </style>
</head>
<body>
  <h1>å­¦ç¥­è¿·è·¯ã‚²ãƒ¼ãƒ </h1>
  <div id="timer"></div>
  <div id="game"></div>
  <div id="inventory"></div>

  <script>
    const gameDiv = document.getElementById("game");
    const timerDiv = document.getElementById("timer");
    const inventoryDiv = document.getElementById("inventory");

    let keywords = JSON.parse(localStorage.getItem('keywords') || '[]');
    let items = JSON.parse(localStorage.getItem('items') || '[]');
    let coins = parseInt(localStorage.getItem('coins') || '0');
    let startTime = parseInt(localStorage.getItem('startTime') || '0');
    let timerInterval;

    // ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°é–¢æ•°
    function startTimer() {
      if(!startTime) startTime = Date.now();
      localStorage.setItem('startTime', startTime);

      timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        timerDiv.textContent = `çµŒéæ™‚é–“: ${minutes}åˆ† ${seconds}ç§’`;
      }, 1000);
    }

    startTimer(); // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ã§ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹

    function updateInventory() {
      let html = "<h3>ç²å¾—ã‚¢ã‚¤ãƒ†ãƒ ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ»ã‚³ã‚¤ãƒ³</h3><ul>";
      keywords.forEach(k => html += `<li>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${k}</li>`);
      items.forEach(i => html += `<li>ã‚¢ã‚¤ãƒ†ãƒ : ${i}</li>`);
      html += `<li>ã‚³ã‚¤ãƒ³: ${coins}</li></ul>`;
      inventoryDiv.innerHTML = html;
    }

    updateInventory();

    // ãƒ›ãƒ¼ãƒ ç”»é¢
    function showHome() {
      gameDiv.innerHTML = `
        <p>ã‚¹ã‚¿ãƒ¼ãƒˆQRã‚’èª­ã¿å–ã£ã¦ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã¦ãã ã•ã„</p>
        <button onclick="startCameraMode()">ã‚«ãƒ¡ãƒ©ãƒ¢ãƒ¼ãƒ‰</button>
      `;
    }

    // QRã‚¯ã‚¤ã‚ºãƒ»ã‚¢ã‚¤ãƒ†ãƒ ãƒ»ã‚³ã‚¤ãƒ³ç®¡ç†
    function showQuiz(num) {
      if (num === "1") gameDiv.innerHTML = `
        <h2>ã‚¯ã‚¤ã‚º1</h2>
        <p>å¤§å­¦ç¥­ã¯ä½•æœˆã«é–‹å‚¬ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ï¼Ÿ</p>
        <button onclick="answer(true,1)">10æœˆã€œ11æœˆ</button>
        <button onclick="answer(false,1)">1æœˆ</button>`;
      else if (num === "2") gameDiv.innerHTML = `
        <h2>ã‚¯ã‚¤ã‚º2</h2>
        <p>QRã‚³ãƒ¼ãƒ‰ã‚’ç™ºæ˜ã—ãŸã®ã¯ã©ã“ã®å›½ï¼Ÿ</p>
        <button onclick="answer(true,2)">æ—¥æœ¬</button>
        <button onclick="answer(false,2)">ã‚¢ãƒ¡ãƒªã‚«</button>`;
      else if (num === "3") gameDiv.innerHTML = `
        <h2>ã‚¯ã‚¤ã‚º3</h2>
        <p>æ¬¡ã®ã†ã¡ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã¯ã©ã‚Œï¼Ÿ</p>
        <button onclick="answer(true,3)">JavaScript</button>
        <button onclick="answer(false,3)">Photoshop</button>`;
      updateInventory();
    }

    function answer(correct, qNum){
      if(correct){
        alert("æ­£è§£ï¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç²å¾—ã—ã¾ã—ãŸğŸ‰");
        if(qNum===1) keywords.push("ç¥­ã®æœˆ");
        else if(qNum===2) items.push("QRã®çŸ¥è­˜");
        else if(qNum===3) keywords.push("ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°");

        localStorage.setItem('keywords', JSON.stringify(keywords));
        localStorage.setItem('items', JSON.stringify(items));
        updateInventory();
        gameDiv.innerHTML = "<p>æ¬¡ã®QRã‚³ãƒ¼ãƒ‰ã‚’æ¢ãã†ï¼</p>";
      } else {
        alert("ä¸æ­£è§£â€¦ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã—ã¦ã¿ã¦ã­ã€‚");
      }
    }

    function collectCoin(){
      coins += 1;
      localStorage.setItem('coins', coins);
      updateInventory();
      alert("ã‚³ã‚¤ãƒ³ã‚’ç²å¾—ã—ã¾ã—ãŸğŸ‰");
    }

    function collectItem(itemName){
      if(!items.includes(itemName)) items.push(itemName);
      localStorage.setItem('items', JSON.stringify(items));
      updateInventory();
      alert(`ã‚¢ã‚¤ãƒ†ãƒ ã€Œ${itemName}ã€ã‚’ç²å¾—ã—ã¾ã—ãŸğŸ‰`);
    }

    function showGoal(){
      if(!keywords.includes("ç¥­ã®æœˆ")){
        gameDiv.innerHTML = "<p>ã¾ã å¿…è¦ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é›†ã‚ã¦ã„ã¾ã›ã‚“ï¼</p>";
        updateInventory();
        return;
      }
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const minutes = Math.floor(elapsed / 60);
      const seconds = elapsed % 60;
      gameDiv.innerHTML = `<h2>ã‚´ãƒ¼ãƒ«ï¼</h2><p>ã‚¯ãƒªã‚¢ã‚¿ã‚¤ãƒ : ${minutes}åˆ† ${seconds}ç§’</p>`;
      updateInventory();
    }

    // ã‚«ãƒ¡ãƒ©ãƒ¢ãƒ¼ãƒ‰
    function startCameraMode(){
      gameDiv.innerHTML = `
        <video id="camera" autoplay playsinline></video>
        <canvas id="arEffect"></canvas>
        <p>ã‚«ãƒ¡ãƒ©ã‚’ä½¿ã£ã¦QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚ã†ï¼</p>
        <button onclick="showHome()">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
      `;

      const video = document.getElementById("camera");
      const canvas = document.getElementById("arEffect");
      const ctx = canvas.getContext("2d");

      navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(stream => {
          video.srcObject = stream;
          video.addEventListener("loadedmetadata", ()=>{
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
          });
        })
        .catch(err => alert("ã‚«ãƒ¡ãƒ©èµ·å‹•å¤±æ•—: "+err));

      // ç°¡æ˜“ARã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆä¾‹: ç‚¹æ»…ã™ã‚‹å††ï¼‰
      function drawEffect(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = `rgba(255,255,0,0.5)`;
        ctx.beginPath();
        ctx.arc(canvas.width/2,canvas.height/2,50+Math.sin(Date.now()/200)*20,0,Math.PI*2);
        ctx.fill();
        requestAnimationFrame(drawEffect);
      }
      drawEffect();
    }

    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã¯ãƒ›ãƒ¼ãƒ è¡¨ç¤º
    showHome();
  </script>
</body>
</html>
