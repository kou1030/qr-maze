<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>è¿·è·¯QRã‚²ãƒ¼ãƒ ã‚µãƒ³ãƒ—ãƒ«</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
<style>
  body { margin:0; overflow:hidden; font-family:sans-serif; }
  #info { position:absolute; top:10px; left:10px; background:rgba(255,255,255,0.8); padding:10px; z-index:10; }
  button { font-size:16px; padding:5px 10px; margin-top:10px; }
</style>
</head>
<body>
<div id="info">è¿·è·¯QRã‚²ãƒ¼ãƒ ã‚µãƒ³ãƒ—ãƒ«</div>

<script>
const params = new URLSearchParams(window.location.search);

let capture;
let keywordCollected = false;

// ARãƒãƒ¼ã‚¯ç”»åƒ
let markImgs = [];
function preload() {
  markImgs[1] = loadImage('https://i.imgur.com/3X5v7Zy.png'); // AR1
  markImgs[2] = loadImage('https://i.imgur.com/I1pQk3G.png'); // AR2
  markImgs[3] = loadImage('https://i.imgur.com/0kXNx5K.png'); // AR3
}

function setup() {
  createCanvas(windowWidth, windowHeight);

  // ARãƒšãƒ¼ã‚¸ã®å ´åˆã¯ã‚«ãƒ¡ãƒ©èµ·å‹•
  if(params.get("ar")) {
    capture = createCapture(VIDEO);
    capture.size(windowWidth, windowHeight);
    capture.hide();
  }
}

function draw() {
  background(255);

  // ã‚¹ã‚¿ãƒ¼ãƒˆãƒšãƒ¼ã‚¸
  if(params.get("s")) {
    fill(0);
    textSize(30);
    textAlign(CENTER);
    text("ã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆï¼", width/2, height/2);
  }

  // ã‚¯ã‚¤ã‚ºãƒšãƒ¼ã‚¸
  else if(params.get("q")) {
    let quizNum = params.get("q");
    fill(0);
    textSize(25);
    textAlign(CENTER);
    text(`ã‚¯ã‚¤ã‚º${quizNum}`, width/2, height/2-30);
    text("æ­£è§£ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç²å¾—", width/2, height/2+10);

    // æ­£è§£ãƒœã‚¿ãƒ³
    if(!keywordCollected){
      fill(0,200,0);
      rect(width/2-60, height/2+40, 120, 40, 10);
      fill(255);
      textSize(18);
      text("æ­£è§£", width/2, height/2+65);
    } else {
      fill(0);
      textSize(20);
      text("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ç²å¾—ã—ã¾ã—ãŸğŸ‰", width/2, height/2+65);
    }
  }

  // ARãƒšãƒ¼ã‚¸
  else if(params.get("ar")) {
    let arNum = params.get("ar");
    image(capture, 0, 0, width, height);
    image(markImgs[arNum], width*0.6, height*0.6, 150, 150);

    fill(255, 255, 255, 200);
    textSize(20);
    textAlign(CENTER);
    if(!keywordCollected){
      text("ãƒãƒ¼ã‚¯ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç²å¾—ï¼", width/2, height*0.5);
    } else {
      text("ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ç²å¾—ã—ã¾ã—ãŸğŸ‰", width/2, height*0.5);
    }
  }

  // ãã‚Œä»¥å¤–
  else {
    fill(0);
    textSize(25);
    textAlign(CENTER);
    text("QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„", width/2, height/2);
  }
}

// ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯ã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç²å¾—
function mousePressed() {
  if(params.get("q") && !keywordCollected){
    let qNum = params.get("q");
    localStorage.setItem(`keyword_q${qNum}`, "ç²å¾—æ¸ˆ");
    keywordCollected = true;
    alert(`ã‚¯ã‚¤ã‚º${qNum}ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ç²å¾—ã—ã¾ã—ãŸğŸ‰`);
  } 
  else if(params.get("ar") && !keywordCollected){
    let arNum = params.get("ar");
    localStorage.setItem(`keyword_ar${arNum}`, "ç²å¾—æ¸ˆ");
    keywordCollected = true;
    alert(`AR${arNum}ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ç²å¾—ã—ã¾ã—ãŸğŸ‰`);
  }
}
</script>
</body>
</html>
