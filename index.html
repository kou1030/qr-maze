<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å­¦ç¥­è¿·è·¯ã‚²ãƒ¼ãƒ </title>
<style>
body { font-family: sans-serif; text-align: center; margin: 40px; }
#timer {
  position: fixed;
  top: 10px;
  right: 10px;
  font-size: 18px;
  background: rgba(255,255,255,0.8);
  padding: 5px 10px;
  border-radius: 5px;
  z-index: 1000;
}
#game { margin-top: 60px; } /* ã‚¿ã‚¤ãƒãƒ¼åˆ†ãƒãƒ¼ã‚¸ãƒ³ã‚’ä¸Šã’ã‚‹ */
#inventory { margin-top: 20px; font-size: 16px; text-align: left; display: inline-block; }
button { padding: 10px 20px; margin: 10px; font-size: 16px; }
</style>
</head>
<body>
<h1>å­¦ç¥­è¿·è·¯ã‚²ãƒ¼ãƒ </h1>
<div id="timer"></div>
<div id="game"></div>
<div id="inventory"></div>

<script>
const params = new URLSearchParams(window.location.search);
const gameDiv = document.getElementById("game");
const timerDiv = document.getElementById("timer");
const inventoryDiv = document.getElementById("inventory");

let keywords = JSON.parse(localStorage.getItem('keywords') || '[]');
let items = JSON.parse(localStorage.getItem('items') || '[]');
let coins = parseInt(localStorage.getItem('coins') || '0');
let startTime = parseInt(localStorage.getItem('startTime') || '0');
let timerInterval;

// ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
function startTimer(reset=false){
  if(reset || !startTime){
    keywords = [];
    items = [];
    coins = 0;
    localStorage.setItem('keywords', JSON.stringify(keywords));
    localStorage.setItem('items', JSON.stringify(items));
    localStorage.setItem('coins', coins);
    startTime = Date.now();
    localStorage.setItem('startTime', startTime);
  }

  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    const elapsed = Math.floor((Date.now() - startTime)/1000);
    const minutes = Math.floor(elapsed/60);
    const seconds = elapsed % 60;
    timerDiv.textContent = `çµŒéæ™‚é–“: ${minutes}åˆ† ${seconds}ç§’`;
  },1000);
}

// ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæ›´æ–°
function updateInventory(){
  let html = "<h3>ç²å¾—ã‚¢ã‚¤ãƒ†ãƒ ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ»ã‚³ã‚¤ãƒ³</h3><ul>";
  keywords.forEach(k=> html+= `<li>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${k}</li>`);
  items.forEach(i=> html+= `<li>ã‚¢ã‚¤ãƒ†ãƒ : ${i}</li>`);
  html+= `<li>ã‚³ã‚¤ãƒ³: ${coins}</li></ul>`;
  inventoryDiv.innerHTML = html;
}

// ã‚¯ã‚¤ã‚ºè¡¨ç¤º
function showQuiz(num){
  if(num==="1") gameDiv.innerHTML = `
    <h2>ã‚¯ã‚¤ã‚º1</h2>
    <p>å¤§å­¦ç¥­ã¯ä½•æœˆã«é–‹å‚¬ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ï¼Ÿ</p>
    <button onclick="answer(true)">10æœˆã€œ11æœˆ</button>
    <button onclick="answer(false)">1æœˆ</button>`;
  else if(num==="2") gameDiv.innerHTML = `
    <h2>ã‚¯ã‚¤ã‚º2</h2>
    <p>QRã‚³ãƒ¼ãƒ‰ã‚’ç™ºæ˜ã—ãŸã®ã¯ã©ã“ã®å›½ï¼Ÿ</p>
    <button onclick="answer(true)">æ—¥æœ¬</button>
    <button onclick="answer(false)">ã‚¢ãƒ¡ãƒªã‚«</button>`;
  else if(num==="3") gameDiv.innerHTML = `
    <h2>ã‚¯ã‚¤ã‚º3</h2>
    <p>æ¬¡ã®ã†ã¡ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã¯ã©ã‚Œï¼Ÿ</p>
    <button onclick="answer(true)">JavaScript</button>
    <button onclick="answer(false)">Photoshop</button>`;
  updateInventory();
}

// ã‚¯ã‚¤ã‚ºè§£ç­”
function answer(correct){
  if(correct){
    alert("æ­£è§£ï¼ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç²å¾—ã—ã¾ã—ãŸğŸ‰");
    const qNum = params.get("q");
    if(qNum==="1") keywords.push("ç¥­ã®æœˆ");
    else if(qNum==="2") items.push("QRã®çŸ¥è­˜");
    else if(qNum==="3") keywords.push("ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°");
    localStorage.setItem('keywords', JSON.stringify(keywords));
    localStorage.setItem('items', JSON.stringify(items));
    updateInventory();
    gameDiv.innerHTML = "<p>æ¬¡ã®QRã‚³ãƒ¼ãƒ‰ã‚’æ¢ãã†ï¼</p>";
  } else {
    alert("ä¸æ­£è§£â€¦ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã—ã¦ã¿ã¦ã­ã€‚");
  }
}

// ã‚³ã‚¤ãƒ³ç²å¾—
function collectCoin(){
  coins+=1;
  localStorage.setItem('coins', coins);
  updateInventory();
  alert("ã‚³ã‚¤ãƒ³ã‚’ç²å¾—ã—ã¾ã—ãŸğŸ‰");
}

// ã‚¢ã‚¤ãƒ†ãƒ ç²å¾—
function collectItem(itemName){
  if(!items.includes(itemName)) items.push(itemName);
  localStorage.setItem('items', JSON.stringify(items));
  updateInventory();
  alert(`ã‚¢ã‚¤ãƒ†ãƒ ã€Œ${itemName}ã€ã‚’ç²å¾—ã—ã¾ã—ãŸğŸ‰`);
}

// ã‚´ãƒ¼ãƒ«
function showGoal(){
  if(!keywords.includes("ç¥­ã®æœˆ")){
    gameDiv.innerHTML = "<p>ã¾ã å¿…è¦ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é›†ã‚ã¦ã„ã¾ã›ã‚“ï¼</p>";
    updateInventory();
    return;
  }
  clearInterval(timerInterval);
  const elapsed = Math.floor((Date.now() - startTime)/1000);
  const minutes = Math.floor(elapsed/60);
  const seconds = elapsed % 60;
  gameDiv.innerHTML = `<h2>ã‚´ãƒ¼ãƒ«ï¼</h2><p>ã‚¯ãƒªã‚¢ã‚¿ã‚¤ãƒ : ${minutes}åˆ† ${seconds}ç§’</p>`;
  updateInventory();
}

// ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
if(params.has("s")) startTimer(true); // ã‚¹ã‚¿ãƒ¼ãƒˆQRã§ãƒªã‚»ãƒƒãƒˆ
else startTimer(false);                // ãã®ä»–ãƒšãƒ¼ã‚¸ã¯å†é–‹

if(params.has("q")) showQuiz(params.get("q"));
else if(params.has("coin")) collectCoin();
else if(params.has("item")) collectItem(params.get("item"));
else if(params.has("goal")) showGoal();
else if(!params.has("s")) gameDiv.innerHTML = "<p>ã‚¹ã‚¿ãƒ¼ãƒˆQRã‚’èª­ã¿å–ã£ã¦ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã¦ãã ã•ã„</p>";

updateInventory();
</script>
</body>
</html>
